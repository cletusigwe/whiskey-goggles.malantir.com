import{r as l,j as e,$ as I,S as M}from"./app-DbzSqnlF.js";import{c as C,B as m,t as c,A as D}from"./AppLayout-DVArcdi2.js";import{P as E}from"./progress-D2YWuv7n.js";import{i as P,c as z}from"./cache-assets-D7TlHRyD.js";/* empty css            *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],U=C("Download",A);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],_=C("History",R);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5",key:"mtk2lu"}],["path",{d:"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5",key:"120jsl"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m18 22-3-3 3-3",key:"kgdoj7"}],["path",{d:"m6 2 3 3-3 3",key:"1fnbkv"}]],H=C("SwitchCamera",F);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],O=C("Upload",L),$=({onCapture:p})=>{const r=l.useRef(null),s=l.useRef(null),[u,d]=l.useState(!1),[x,w]=l.useState("environment"),[o,h]=l.useState("available"),[k,b]=l.useState([]),[f,y]=l.useState(!1);l.useEffect(()=>((async()=>{try{const v=(await navigator.mediaDevices.enumerateDevices()).filter(N=>N.kind==="videoinput");if(v.length===0){h("unavailable"),b([]);return}b(v),h("available");const S=v.some(N=>N.label.toLowerCase().includes("back")||N.label.toLowerCase().includes("rear"));w(S?"environment":"user")}catch{h("error"),b([]),c.error("Camera access failed",{description:"Unable to detect cameras. Please check permissions."})}})(),()=>{s.current&&(s.current.getTracks().forEach(n=>n.stop()),s.current=null)}),[]);const t=async()=>{if(o!=="available"||f){o!=="available"&&c.error("Camera unavailable",{description:o==="unavailable"?"No camera detected.":"Camera access error."});return}y(!0);try{s.current&&(s.current.getTracks().forEach(n=>n.stop()),s.current=null,r.current&&(r.current.srcObject=null));const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:x}});s.current=a,r.current&&(r.current.srcObject=a,await r.current.play()),d(!0)}catch(a){h("error");let n="Failed to access camera.";a instanceof DOMException&&(a.name==="NotAllowedError"?n="Camera access denied. Please grant permissions.":a.name==="NotFoundError"&&(n="No camera found on this device.",h("unavailable"))),c.error("Camera error",{description:n})}finally{y(!1)}},i=()=>{s.current&&(s.current.getTracks().forEach(a=>a.stop()),s.current=null),r.current&&(r.current.srcObject=null),d(!1)},g=()=>{f||(w(a=>a==="user"?"environment":"user"),i(),t())},j=()=>{if(!r.current||!u)return;const a=document.createElement("canvas");a.width=r.current.videoWidth,a.height=r.current.videoHeight;const n=a.getContext("2d");if(n){n.drawImage(r.current,0,0,a.width,a.height);const v=a.toDataURL("image/jpeg",.8);p(v),i()}};return e.jsx("div",{className:"relative mx-auto w-full max-w-md",children:e.jsxs("div",{className:"relative aspect-[3/4] w-full overflow-hidden rounded-lg",children:[o==="available"&&e.jsx("video",{ref:r,className:"h-full w-full object-cover",playsInline:!0,autoPlay:!0,muted:!0}),!u&&o==="available"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-amber-200",children:e.jsx(m,{className:"cursor-pointer bg-amber-600 text-white hover:bg-amber-700",onClick:t,disabled:f,children:"Start Camera"})}),o!=="available"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-amber-200",children:e.jsx(m,{className:"cursor-pointer bg-amber-600 text-white hover:bg-amber-700",onClick:t,disabled:f,children:o==="unavailable"?"No Camera Detected":"Allow Camera"})}),u&&k.length>1&&e.jsx(m,{variant:"outline",size:"icon",className:"absolute top-2 right-2 cursor-pointer border-amber-600 text-amber-800 hover:bg-amber-100",onClick:g,disabled:f,children:e.jsx(H,{className:"h-5 w-5"})}),u&&e.jsx("div",{className:"absolute bottom-4 left-1/2 flex h-16 w-16 -translate-x-1/2 transform cursor-pointer items-center justify-center rounded-full bg-white",onClick:j,children:e.jsx("div",{className:"h-12 w-12 rounded-full bg-red-500"})})]})})},W=()=>{const[p,r]=l.useState(null),[s,u]=l.useState(!1),[d,x]=l.useState(null),[w,o]=l.useState(!0);l.useEffect(()=>{(async()=>{const i=await P();o(i)})()},[]);const h=async()=>{u(!0),x(null);try{await z((t,i)=>{x({...t,assetName:i})}),c.success("Model assets downloaded",{description:"You can now identify whiskeys offline."}),o(!0)}catch(t){c.error("Download failed",{description:t instanceof Error?t.message:"An unknown error occurred"})}finally{u(!1),x(null)}},k=t=>{r(t),sessionStorage.setItem("capturedImage",t)},b=t=>{var j;const i=(j=t.target.files)==null?void 0:j[0];if(!i)return;if(!["image/jpeg","image/png"].includes(i.type)){c.error("Invalid file type",{description:"Please upload a JPEG or PNG image."});return}if(i.size>5*1024*1024){c.error("File too large",{description:"Please upload an image smaller than 5MB."});return}const g=new FileReader;g.onload=()=>{const a=g.result;r(a),sessionStorage.setItem("capturedImage",a)},g.onerror=()=>{c.error("Failed to read file",{description:"Please try another image."})},g.readAsDataURL(i)},f=()=>{p?M.visit("/results"):c.error("No image selected",{description:"Please capture or upload an image first."})},y=()=>{r(null),sessionStorage.removeItem("capturedImage")};return e.jsx(D,{title:"Capture",children:e.jsx("main",{className:"flex min-h-screen flex-col bg-amber-50",children:e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center p-4",children:e.jsxs("div",{className:"mx-auto w-full max-w-md",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"mb-2 text-4xl font-bold text-amber-900",children:"Whiskey Goggles"}),e.jsx("p",{className:"text-amber-700",children:"Snap, identify, and catalog your whiskey collection"}),e.jsx("p",{className:"mt-2 text-sm text-amber-600",children:"All inference is performed locally on your device to save costs."})]}),e.jsxs("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:[s&&d&&e.jsxs("div",{className:"mb-4 w-full",children:[e.jsxs("p",{className:"mb-2 text-sm text-amber-700",children:["Downloading ",d.assetName,"..."]}),e.jsx(E,{value:d.total>0?d.loaded/d.total*100:void 0,className:"h-2 w-full"})]}),!w&&!s&&e.jsxs(m,{className:"mb-4 w-full cursor-pointer bg-amber-600 text-white hover:bg-amber-700",disabled:s,onClick:h,size:"lg",children:[e.jsx(U,{className:"mr-2 h-5 w-5"}),"Download Model"]}),p?e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"relative mx-auto mb-4 aspect-[3/4] w-full max-w-xs overflow-hidden rounded-lg",children:e.jsx("img",{src:p,alt:"Captured whiskey",className:"h-full w-full object-contain"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",className:"flex-1 cursor-pointer border-amber-600 text-amber-800 hover:bg-amber-100",onClick:y,size:"lg",children:"Change Image"}),e.jsx(m,{className:"flex-1 cursor-pointer bg-amber-600 text-white hover:bg-amber-700",onClick:f,size:"lg",children:"Analyze"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx($,{onCapture:k}),e.jsx(m,{variant:"outline",className:"mt-4 w-full cursor-pointer border-amber-600 text-amber-800 hover:bg-amber-100",asChild:!0,size:"lg",children:e.jsxs("label",{children:[e.jsx(O,{className:"mr-2 h-5 w-5"}),"Upload Image",e.jsx("input",{type:"file",accept:"image/jpeg,image/png",className:"hidden",onChange:b})]})}),e.jsx(m,{variant:"outline",className:"mt-4 w-full cursor-pointer border-amber-600 text-amber-800 hover:bg-amber-100",size:"lg",children:e.jsxs(I,{href:"/history",className:"flex h-full w-full items-center justify-center",children:[e.jsx(_,{className:"mr-2 h-5 w-5"}),"View History"]})})]})]})]})})})})};export{W as default};
